

- name: set hostname using host if host is defined
  set_fact: hostname={{host}}
  when: host is defined
  
- name: set hostname using inventory_hostname is inventory_hostname is not an ip number
  set_fact: hostname={{host}}
  when: not inventory_hostname|match('(\d{1,3}\.){3}\d{1,3}')

- debug:
    msg: "inventory_hostname is {{ inventory_hostname }}  ansible_hostname is {{ansible_hostname}} host is {{ host }} hostname is {{hostname}} " 

- name: Ensure hostname set
  hostname: name={{ hostname }}

- name: Ensure hostname is in /etc/hosts
  lineinfile:
    dest=/etc/hosts
    regexp="^{{ ansible_default_ipv4.address }}.+$"
    line="{{ ansible_default_ipv4.address }} {{ ansible_fqdn }} {{ hostname }}"
