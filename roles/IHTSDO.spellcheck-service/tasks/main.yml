---
- name: Stop any running instances
  supervisorctl: name={{ spellcheck_name }}  state=stopped
  failed_when: false

- name: Install package
  apt: name={{ spellcheck_name }} state=installed force=yes update_cache=yes
  when: spellcheck_version == 'present'

- name: Install package
  apt: name={{ spellcheck_name }} state=installed force=yes update_cache=yes
  when: spellcheck_version == 'absent'

- name: Install latest package
  apt: name={{ spellcheck_name }} state=latest force=yes update_cache=yes
  when: spellcheck_version == 'latest'

- name: Install package specific version
  apt: name={{ spellcheck_name }}={{ spellcheck_version }} state=installed force=yes
  when: spellcheck_version != 'installed' and spellcheck_version != 'latest' and spellcheck_version != 'absent'

- name: Copy application.properties
  spellcheck: src=application.properties.j2 dest=/opt/{{ spellcheck_name }}/application.properties owner={{ spellcheck_name }} group=root mode=0644

- name: Ensure the spellcheck_store exists
  file: path="/opt/{{ spellcheck_name }}/spellcheck-store" state=directory owner={{ spellcheck_name }}

- name: (re)start spellcheck-service
  supervisorctl: name={{ spellcheck_name }}  state=restarted
