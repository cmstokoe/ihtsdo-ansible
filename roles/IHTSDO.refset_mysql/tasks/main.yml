---

#- name: include secret settings
#  include_vars: "{{ secret_settings }}"

- name: Apt cache update
  apt: update_cache=yes cache_valid_time=300 
  
 #include system vars
- include: "{{systemchoice}}"

- name: Install unzip
  apt: name=unzip state=present update_cache=yes cache_valid_time=300 
  
- name: Install maven
  apt: name=maven state=present update_cache=yes cache_valid_time=300   
 
- name: Install speedometer for use in seeing how downloads are going (initial testing only)
  apt: name=speedometer state=present update_cache=yes cache_valid_time=300  
 
#- name: Stop app if running
#  supervisorctl: name={{app_name}} state=stopped
  

- name: install db
  include: db.yml  


- name: Install tomcat - apt for now. should be bundled as the the std.
  apt: name=tomcat7 state=present update_cache=yes cache_valid_time=300 


- name: restart tomcat
  service: name=tomcat7 state=restarted 


#Get Backup sql file from S3
  
#- name: Remove datadir so as to spark complete rebuild
#  file: path={{import_base_dir_sql}} state=absent
#  when: "force_zip_download_sql == True" 

#- name: make sure dataDir exists
#  file: path={{import_base_dir_sql}}  state=directory
  
#- name: make sure zip file exists
#  stat: path={{import_zip_file_sql}}
#  register: repozipimportfile  
  
#- include: setdbcontent.yml
#  when: installdbcontent == True

#- name: Start App
#  supervisorctl: name={{app_name}} state=started



