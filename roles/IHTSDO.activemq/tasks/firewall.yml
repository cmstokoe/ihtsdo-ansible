- debug: msg="inventory_hostname  =  {{ inventory_hostname }} "
- set_fact: zabbixserver1={{ hostvars[groups['zabbixserver'][0]]['inventory_hostname'] }}
- debug: msg="zabbix server =  {{zabbixserver1}}"

- name: resolve  zabbix server to ip
  shell: "dig +short {{ zabbixserver1 }} | grep -v '\\.$' | head -n 1"
  register: resolved_hostname

- debug: msg="zabbix server ip =  {{resolved_hostname.stdout}}"

- name: open up firewall but just for zabbix server
  ufw: rule=allow port=1099:2000 proto=tcp from_ip={{ resolved_hostname.stdout }}
