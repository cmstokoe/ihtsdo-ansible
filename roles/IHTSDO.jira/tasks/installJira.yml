---
#Create the default user
- name: Ensure jira group exists
  group: name=jira  state=present system=yes 

- name: Ensure jira user exists
  user: name=jira group=jira state=present system=yes  

#Create installation dir
- name: Create jira installation dsirectory
  file: path={{ jira_install }} state=directory owner=jira  group=jira

#Download and Extract the source
- name: Extract Jira
  unarchive: src="{{ jira_url }}" dest={{ jira_install }} owner=jira  group=jira copy=no

#Rename installation directory
- name: Make the installed path version neutral
  command: mv {{ jira_install }}/atlassian-jira-software-{{ jira_version }}-standalone {{ jira_install }}/jira

#Create home dir
- name: Create jira-home
  file: path={{ jira_home }} state=directory owner=jira  group=jira

#Update config file 
- name: Set java_home in the application
  lineinfile: 
     dest="{{ jira_install }}/jira/atlassian-jira/WEB-INF/classes/jira-application.properties"
     regexp="^jira.home ="
     line="jira.home = {{ jira_home }}"

