---
- name: Apt cache update
  apt: update_cache=yes cache_valid_time=120
  tags:
    - ihtsdo-asset

- name: Install snomed-release-service-web package
  apt: name=snomed-release-service-web state=installed
  notify:
    - reload nginx
  when: snomed_release_service_web_version == 'installed'
  tags:
    - ihtsdo-asset

- name: Install latest snomed-release-service-web package
  apt: name=snomed-release-service-web state=latest
  notify:
    - reload nginx
  when: snomed_release_service_web_version == 'latest'
  tags:
    - ihtsdo-asset

- name: Install snomed-release-service-web package
  apt: name=snomed-release-service-web={{ snomed_release_service_web_version }} state=installed
  notify:
    - reload nginx
  when: snomed_release_service_web_version != 'installed' and snomed_release_service_web_version != 'latest'
  tags:
    - ihtsdo-asset

- name: Configure nginx service
  template: src=nginx_conf.j2 dest=/etc/nginx/conf.d/snomed-release-service-web.conf
            owner=root group=root mode=0644
  notify:
    - reload nginx
  tags:
    - ihtsdo-asset
