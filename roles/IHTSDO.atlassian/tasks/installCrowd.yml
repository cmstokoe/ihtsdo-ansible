---
#Create the default user
- name: Ensure crowd group exists
  group: name={{ system_group }}  state=present system=yes 

- name: Ensure crowd user exists
  user: name={{ system_user }} group={{ system_group }} state=present system=yes  

#Create installation dir
- name: Create crowd installation directory
  file: path={{ common_install }} state=directory owner={{ system_user }}  group={{ system_group }}

#Download and Extract the source
- name: Download and extract Crowd
  unarchive: src="{{ common_download_location }}/{{ crowd_archive }}" dest={{ common_install }} owner={{ system_user }}  group={{ system_group }} copy=no

#Rename installation directory
- name: Make the installed path version neutral
  command: mv {{ common_install }}/atlassian-crowd-{{ crowd_version }} {{ common_install }}/crowd

#Create home dir
- name: Create crowd home directory
  file: path="{{ common_home }}/crowd" state=directory owner={{ system_user }}  group={{ system_group }}

#Update config file 
- name: Set crowd home dir in init properties
  lineinfile: 
      dest="{{ common_install }}/crowd/crowd-webapp/WEB-INF/classes/crowd-init.properties"
      line="crowd.home={{ common_home }}/crowd"

#Use crowd  user
#- name: Set default user for confluence
#  lineinfile:
#     dest="{{ common_install }}/confluence/bin/user.sh"
#     regexp="^CONF_USER="
#     line="CONF_USER={{ system_user }}"

