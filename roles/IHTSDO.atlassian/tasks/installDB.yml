
#- name: Set MySQL root password before installing
- debconf: name='mysql-server' question='mysql-server/root_password' value='{{mysql_root_password | quote}}' vtype='password'

#- name: Confirm MySQL root password before installing
- debconf: name='mysql-server' question='mysql-server/root_password_again' value='{{mysql_root_password | quote}}' vtype='password'

# Install the package "mysql-server"
- name: Install mysql server
  apt: name=mysql-server state=present
  when: (atlassian_application=="jira" or atlassian_application=="cloud")

# Install the package "mysql-server"
- name: Install mysql server
  apt: name=mysql-server-5.6 state=present
  when: atlassian_application=="confluence"

#mysql additional settings
- name: Set innodb buffer size
  lineinfile:
     dest="/etc/mysql/my.cnf"
     insertafter="\[mysqld\]"
     line="innodb_buffer_pool_size = 2G"

#mysql additional settings
- name: Set max packet size
  lineinfile:
     dest="/etc/mysql/my.cnf"
     insertafter="\[mysqld\]"
     line="max_allowed_packet=1G"

# Install the package "python-mysqldb"
- name: Install mysql python helper
  apt: name=python-mysqldb state=present
  
# Starts mysql as a service
- name: restart mysql
  service: name=mysql state=restarted 
