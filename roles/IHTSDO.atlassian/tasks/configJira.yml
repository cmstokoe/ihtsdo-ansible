---
#Update config file
- name: Set jira_home in application
  lineinfile:
     dest="{{ common_install }}/jira/atlassian-jira/WEB-INF/classes/jira-application.properties"
     regexp="^jira.home ="
     line="jira.home = {{ common_home }}/jira"

#Use jira user
- name: Set default user for jira
  lineinfile:
     dest="{{ common_install }}/jira/bin/user.sh"
     regexp="^JIRA_USER="
     line="JIRA_USER={{ system_user }}"

# Creates database user for jira  with all database privileges and 'WITH GRANT OPTION'
- name: Create default database user for application
  mysql_user: name={{ mysql_user }} password={{ mysql_password }} login_user=root login_password={{ mysql_root_password }} priv=*.*:ALL,GRANT state=present

# Create the database
- name: Create default database
  mysql_db: name={{mysql_db}} login_user={{mysql_user}} login_password={{mysql_password}} encoding=utf8 state=present

# Configure mysql database server in jira
- name: Configure application to use mysql
  template: src=templates/dbconfig.xml.j2 dest={{common_home}}/{{atlassian_application}}/dbconfig.xml owner={{ system_user }} group={{ system_group }}
  when: atlassian_application == "jira"

#- name: Hardcode JRE_HOME for Oracle Java 8 
#  lineinfile:
#     dest="{{ common_install }}/jira/bin/catalina.sh"
#     insertafter="#!/bin/sh"
#     line="JRE_HOME=\"/usr/lib/jvm/java-8-oracle/jre\"
